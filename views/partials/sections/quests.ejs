<!-- views/partials/sections/quests.ejs -->
<section id="quests" class="section tab-content">
    <div class="quests-container">
        <h2 class="section-title">Qu√™tes Quotidiennes</h2>

        <!-- Filtres -->
        <div class="quest-filters">
            <div class="search-bar">
                <input type="text" id="quest-search" placeholder="Rechercher une qu√™te...">
            </div>
            
            <div class="filter-group">
                <select id="stat-filter">
                    <option value="">Toutes les statistiques</option>
                    <% Object.entries(stats).forEach(([key, stat]) => { %>
                        <option value="<%= key %>"><%= stat.emoji %> <%= stat.label %></option>
                    <% }) %>
                </select>

                <select id="difficulty-filter">
                    <option value="">Toutes les difficult√©s</option>
                    <option value="facile">Facile</option>
                    <option value="moyen">Moyen</option>
                    <option value="difficile">Difficile</option>
                </select>

                <select id="status-filter">
                    <option value="">Tous les statuts</option>
                    <option value="pending">√Ä faire</option>
                    <option value="completed">Compl√©t√©es</option>
                </select>
            </div>
        </div>

        <!-- Timeline et qu√™tes -->
        <div class="quests-timeline-container">
            <!-- Timeline -->
            <div class="timeline">
                <div class="timeline-line"></div>
                <% let totalQuests = user.dailyQuests.length;
                   let completedQuests = user.dailyQuests.filter(q => q.completed).length; %>
                <div class="timeline-progress" style="height: <%= (completedQuests/totalQuests) * 100 %>%"></div>
                
                <div class="timeline-markers">
                    <div class="time-marker morning">üåÖ Matin</div>
                    <div class="time-marker afternoon">‚òÄÔ∏è Apr√®s-midi</div>
                    <div class="time-marker evening">üåô Soir</div>
                </div>
            </div>

            <!-- Liste des qu√™tes -->
            <div class="quests-list">
				<% if (user.dailyQuests && user.dailyQuests.length > 0) { %>
					<% const activeQuests = user.dailyQuests.filter(quest => !quest.completed); %>
					<% if (activeQuests.length > 0) { %>
						<% activeQuests.forEach(quest => { %>
							<div class="quest-card" 
								data-id="<%= quest._id %>"
								data-stat="<%= quest.stat %>"
								data-difficulty="<%= quest.difficulty %>">
                            
                            <div class="quest-time-indicator"></div>
                            
                            <div class="quest-content">
                                <div class="quest-header">
                                    <span class="quest-emoji"><%= stats[quest.stat].emoji %></span>
                                    <h3 class="quest-title"><%= quest.name %></h3>
                                    <span class="quest-difficulty <%= quest.difficulty %>">
                                        <%= quest.difficulty ? quest.difficulty.charAt(0).toUpperCase() + quest.difficulty.slice(1) : 'Difficult√© non d√©finie' %>
                                    </span>
                                </div>

                                <div class="quest-info">
                                    <span class="quest-type" style="color: <%= stats[quest.stat].color %>">
                                        <%= stats[quest.stat].label %>
                                    </span>
                                    <span class="quest-reward">+<%= quest.xpReward %> XP</span>
                                    
                                    <% if (quest.streak > 1) { %>
                                        <span class="quest-streak">
                                            üî• <%= quest.streak %> jours
                                        </span>
                                    <% } %>
                                </div>

                                <% if (quest.timer) { %>
                                    <div class="quest-timer" data-duration="<%= quest.timer %>">
                                        <span class="timer-icon">‚è±Ô∏è</span>
                                        <span class="timer-display">00:00</span>
                                    </div>
                                <% } %>

                                <div class="quest-actions">
                                    <button class="complete-button <%= quest.completed ? 'completed' : '' %>"
                                            <%= quest.completed ? 'disabled' : '' %>
                                            onclick="completeQuest(this)">
                                        <%= quest.completed ? '‚úì Compl√©t√©' : 'Compl√©ter' %>
                                    </button>
                                    
                                    <% if (quest.timer) { %>
                                        <button class="timer-button" onclick="startQuestTimer(this)">
                                            D√©marrer
                                        </button>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div class="empty-state">
                        <div class="empty-icon">üéØ</div>
                        <h3>Aucune qu√™te disponible</h3>
                        <p> Cr√©ez une nouvelle qu√™te pour continuer votre progression !</p>
                        <button onclick="switchTab('create-quest')" class="create-quest-btn">
                            Cr√©er une qu√™te
                        </button>
                    </div>
                <% } %>
			<% } else { %>
				<!-- √âtat vide existant... -->
			<% } %>
		</div>	
    </div>
</section>